// By default, all objects and buckets are private— only the user that created them can access them. 
// A presigned URL allows a user that does not have access permissions to upload files to the bucket.
// This URL is generated by the user who has access to the bucket and who will grant temporary permissions to anyone who knows it
// Because this URL needs to stay secret, you’ll create a new route in the Pizza API that will generate and return that URL.

const { v4: uuid } = require('uuid');
const AWS = require('aws-sdk');
const s3 = new AWS.S3();

function generatePresignedUrl() {
  const params = {
    Bucket: "aunt-marias-pizzeria-murat",
    Key: uuid(),
    ACL: 'public-read',
    Expires: 120
  }

  // After generating the options object, use the getSignedUrl method to sign the URL and then return it as a JSON object.

  return new Promise((resolve, reject) => {
    s3.getSignedUrl('putObject', params, (err, url) => {
      if (err) {
        return reject(err);
      }

      resolve({
        url: url
      })
    })
  })
}

module.exports = generatePresignedUrl;